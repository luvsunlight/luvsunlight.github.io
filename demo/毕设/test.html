<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="./libs/jquery.min.js"></script>
    <script src="./libs/dat.gui.js"></script>
    <title>Document</title>
    <style>
        html,body{
            overflow: hidden;
        }
        .canvas-box {
            position: relative;
            left: 60px;
        }
        canvas {
            margin-right: 60px;
        }
        .label-box {
            position: relative;
            left: 240px;
        }
        .label {
            float: left;
            margin-right: 440px;
        }

    </style>
</head>
<div class="canvas-box">
    <canvas id="canvas1" width="500" height="600"></canvas>
    <canvas id="canvas2" width="500" height="600"></canvas>
</div>
<div class="label-box">
    <div class="label label1">label1</div>
    <div class="label label2">label2</div>
</div>
<body>
    <script type="text/javascript">
    initGUI();
    var myRGB = function(hex){
        this.r = parseInt("0x" + hex.slice(1, 3));
        this.g = parseInt("0x" + hex.slice(3, 5));
        this.b = parseInt("0x" + hex.slice(5, 7));
    };
    myRGB.prototype.toRGB = function(alpha) {
        alpha = alpha || false;
        if(!alpha){
            return 'rgb(' + this.r + ',' + this.g + ',' + this.b + ')';
        }else {
            return 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + alpha + ')';
        }
    };

    var rgb = new myRGB(controls.color);
	background = rgb.toRGB();
	backgroundAlpha = rgb.toRGB(controls.delta);

    var c=document.getElementById("canvas1");
    ctx=c.getContext("2d");
    ctx.fillStyle=background;
    ctx.fillRect(0,0,1000,600);

    c=document.getElementById("canvas2");
    ctx2=c.getContext("2d");
    ctx2.fillStyle = backgroundAlpha;
    ctx2.fillRect(0,0,1000,600);

    render(function(){

        backgroundAlpha = new myRGB(controls.color).toRGB(controls.delta);

        ctx2.fillStyle = backgroundAlpha;
        ctx2.fillRect(0,0,1000,600);

        var c1 = ctx.getImageData(100, 100, 1, 1).data;
        $('.label1')[0].innerHTML = 'rgba('+c1[0]+','+c1[1]+','+c1[2]+','+c1[3]+')';

        var c2 = ctx2.getImageData(100, 100, 1, 1).data;
        $('.label2')[0].innerHTML = 'rgba('+c2[0]+','+c2[1]+','+c2[2]+','+c2[3]+')';
    })

    function initGUI() {
        controls = new function(){
            this.delta = 0.1;
            this.color = '#000000';
            this.cover = false;
        }
        function redraw(){
            var ctx = document.getElementById("canvas1").getContext("2d");
            ctx.clearRect(0,0,1000,600);
            ctx.fillStyle = new myRGB(controls.color).toRGB();
            ctx.fillRect(0,0,1000,600);

            var ctx2 = document.getElementById("canvas2").getContext("2d");
            var clear = true;

            if(controls.cover){
                $('canvas').animate({"margin-right":"-60px"});
                $('.label').animate({"margin-right":"340px"});
                clear = false;
            }else{
                $('canvas').animate({"margin-right":"60px"});
                $('.label').animate({"margin-right":"440px"});
            }

            if(clear){
                ctx2.clearRect(0,0,1000,600);
            }
        }

        var gui = new dat.GUI();
        gui.add(controls,'delta',0, 1).onChange(redraw);
        gui.addColor(controls,'color').onChange(redraw);
        gui.add(controls,'cover').onChange(redraw);
    }

    function render(fx) {
        setInterval(fx,50);
    }
    </script>
</body>
</html>
